(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}var o=document.querySelector("#card-template").content;function r(e,t,n,r){var c=o.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__like-button"),u=c.querySelector(".card__image");u.src=e.link,u.alt=e.name,u.addEventListener("click",(function(){return r(e)})),c.querySelector(".card__title").textContent=e.name;var a=e._id;i.addEventListener("click",(function(e){n.likeCard(e,a,n)})),c.querySelector(".card__like-counter").textContent=0===e.likes.length?"":e.likes.length,e.likes.some((function(e){return e._id===t}))&&i.classList.add("card__like-button_is-active");var l=c.querySelector(".card__delete-button");return e.owner._id!==t?l.remove():l.addEventListener("click",(function(){return n.confirmDeletion(c,a)})),c}var c=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),t.setCustomValidity(""),o.textContent=""};function i(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));u(n,e.querySelector(t.submitButtonSelector),t),n.forEach((function(n){c(e,n,t)}))}function u(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}var a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},l="https://nomoreparties.co/v1/wff-cohort-12",s={authorization:"e072955e-4ca1-47b4-add8-5a725e806251","Content-Type":"application/json"},d=function(e){return fetch("".concat(l,"/").concat(e.url),{method:"".concat(e.method),headers:s,body:JSON.stringify(e.body)}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?c(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n),t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity("")}(e,r,t),u(n,o,t)}))}))}(t,e)}))}(a);var p,f=document.querySelector(".places__list"),m={likeCard:function(e,t,n){var o=e.target,r=o.closest(".card").querySelector(".card__like-counter");o.classList.contains("card__like-button_is-active")?n.deleteLike(t).then((function(e){o.classList.toggle("card__like-button_is-active"),r.textContent=0===e.likes.length?"":e.likes.length})).catch((function(e){return console.log(e)})):n.addLike(t).then((function(e){o.classList.toggle("card__like-button_is-active"),r.textContent=0===e.likes.length?"":e.likes.length})).catch((function(e){return console.log(e)}))},openImagePopup:V,confirmDeletion:function(t,n){e(_),p={cardId:n,cardElement:t}},deleteLike:function(e){return d({url:"cards/likes/".concat(e),method:"DELETE"})},addLike:function(e){return d({url:"cards/likes/".concat(e),method:"PUT"})}},_=document.querySelector(".popup_type_confirm_card_deletion");_.querySelector(".popup__button").addEventListener("click",(function(e){var n;e.preventDefault(),(n=p.cardId,d({url:"cards/".concat(n),method:"DELETE"})).then((function(){p.cardElement.remove(),t(_)})).catch((function(e){return console.log(e)}))}));var v=document.querySelector(".profile__edit-button"),y=document.querySelector(".popup_type_edit"),h=document.forms["edit-profile"],k=h.elements.name,S=h.elements.description,b=document.querySelector(".profile__info"),L=b.querySelector(".profile__title"),C=b.querySelector(".profile__description");function E(e){L.textContent=e.name,C.textContent=e.about.replace(/[^а-яА-ЯёЁa-zA-Z \-]+/g,""),g.style.backgroundImage="url(".concat(e.avatar,")")}v.addEventListener("click",(function(){k.value=L.textContent,S.value=C.textContent,e(y),i(h,a)})),h.addEventListener("submit",(function(e){return function(e,n,o){e.preventDefault(),e.submitter.textContent="Сохранение...",function(e,t){return d({url:"users/me",method:"PATCH",body:{name:e,about:t}})}(n,o).then((function(e){E(e),t(y)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Сохранить"}))}(e,k.value,S.value)})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(n){t(e)})),e.addEventListener("click",(function(n){n.target.classList.contains("popup_is-opened")&&t(e)}))}));var g=document.querySelector(".profile__image"),q=document.querySelector(".popup_type_update_avatar"),x=document.forms.update__avatar,A=x.elements.link;g.addEventListener("click",(function(){g.classList.add("clicked"),A.value="",e(q),i(x,a)})),g.addEventListener("mouseout",(function(){return g.classList.remove("clicked")})),x.addEventListener("submit",(function(e){return function(e,n){e.preventDefault(),e.submitter.textContent="Сохранение...",function(e){return d({url:"users/me/avatar",method:"PATCH",body:{avatar:e}})}(n).then((function(e){g.style.backgroundImage="url(".concat(e.avatar,")"),t(q)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Сохранить"}))}(e,A.value)}));var D=document.querySelector(".profile__add-button"),T=document.querySelector(".popup_type_new-card"),w=document.forms["new-place"],P=w.elements["place-name"],B=w.elements.link;D.addEventListener("click",(function(){w.reset(),i(w,a),e(T)})),w.addEventListener("submit",(function(e){e.preventDefault(),e.submitter.textContent="Сохранение...",function(e){return d({url:"cards",method:"POST",body:e})}({name:P.value,link:B.value}).then((function(e){f.prepend(r(e,e.owner._id,m,V)),t(T)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Создать"}))}));var I=document.querySelector(".popup_type_image"),j=document.querySelector(".popup__image"),M=document.querySelector(".popup__caption");function V(t){console.log(t),j.src=t.link,j.alt=t.name,M.textContent=t.name,e(I)}Promise.all([d({url:"users/me",method:"GET"}),fetch("".concat(l,"/cards"),{headers:s}).then((function(e){return e.json()}))]).then((function(e){E(e[0]),e[1].forEach((function(t){!function(e,t,n,o){f.append(r(e,t,n,o))}(t,e[0]._id,m,V)}))})).catch((function(e){return console.log(e)}))})();